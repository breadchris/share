<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Collaborative Text Box</title>
    <style>
        #text-box {
            width: 100%;
            height: 400px;
            border: 1px solid #ccc;
            padding: 10px;
        }
        #name-input {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
<input type="text" id="name-input" placeholder="Enter your name" />
<textarea id="text-box"></textarea>
<script>
    const textBox = document.getElementById('text-box');
    const nameInput = document.getElementById('name-input');
    const ws = new WebSocket(`ws://${window.location.host}/text/ws`);

    ws.onopen = function() {
        nameInput.addEventListener('change', function() {
            const name = nameInput.value;
            ws.send(JSON.stringify({
                type: "setName",
                data: { name }
            }));
        });
    };

    ws.onmessage = function(event) {
        const message = JSON.parse(event.data);
        switch (message.type) {
            case 'textUpdate':
                textBox.value = atob(message.data);
                break;
            case 'nameChange':
                handleNameChange(message.data);
                break;
            // Handle other event types as needed
        }
    };

    const handleNameChange = (data) => {
        console.log(`Client ${data.client_id} set their name to ${data.name}`);
    };

    textBox.addEventListener('input', function() {
        ws.send(JSON.stringify({
            type: "textUpdate",
            data: btoa(textBox.value)
        }));
    });
</script>
</body>
</html>
